#!/bin/bash
#!/bin/sh
# sethost       sethost init configuration
# chkconfig:    2345 10 90
# version:      0.1
# author:       knopp
#echo "domain-name {{ DOMAIN_NAME }}" > /etc/resolv.conf
echo "nameserver 127.0.0.1" > /etc/resolv.conf
cp /etc/hosts /tmp/hosts
myip=`ip addr show {{ VXLAN_DEV }} | grep 'inet ' | awk -F '[/ ]' '{print $6}'`
sed -i "/$myip/d" /tmp/hosts
cat /tmp/hosts > /etc/hosts
{% if link_local is defined %}
ip route add 169.254.0.0/24 via $myip dev {{ VXLAN_DEV }}
ip route del 169.254.0.0/16 dev {{ VXLAN_DEV }}  
{% endif %}

