---
  - name: "install nfs packages"
    become: yes
    dnf: 
      name: nfsserver
      state: present
    tags:
      - nfsserver

  - name: "create nfs root directory"
    become: yes
    file: 
      path: "{{ STORAGE_ROOT }}" 
      state: directory
      owner: root 
      group: root
      mode: 0755
    tags:
      - nfsserver

  - name: "create exports"
    become: yes
    template: 
      src: exports.j2
      dest: /etc/exports
      owner: root
      group: root
      mode: 0644
    tags:
      - nfsserver

  - name: "restart nfs"
    become: yes
    systemd:
      name: "{{ item }}"
      state: restarted 
      enabled: yes
    with_items:
      - rpcbind
      - nfs-server
      - nfs-idmap
    tags:
      - nfsserver
